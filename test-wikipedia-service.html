<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia Service Test - ã‚²ãƒ¼ãƒ æƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            min-height: 50px;
        }
        .loading {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .info-item {
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        .info-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }
        .info-value {
            color: #333;
        }
        .attribution {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 14px;
        }
        .sample-games {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .sample-game {
            padding: 5px 10px;
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .sample-game:hover {
            background-color: #cce7ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Wikipedia Service Test</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            ã‚²ãƒ¼ãƒ æƒ…å ±ã‚’Wikipediaã‹ã‚‰å–å¾—ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™
        </p>

        <div class="test-section">
            <h2>ğŸ” ã‚²ãƒ¼ãƒ æ¤œç´¢ãƒ†ã‚¹ãƒˆ</h2>
            <p>ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦Wikipediaã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
            
            <div class="sample-games">
                <span class="sample-game" onclick="setGameTitle('The Legend of Zelda Breath of the Wild')">ã‚¼ãƒ«ãƒ€ã®ä¼èª¬ ãƒ–ãƒ¬ã‚¹ ã‚ªãƒ– ã‚¶ ãƒ¯ã‚¤ãƒ«ãƒ‰</span>
                <span class="sample-game" onclick="setGameTitle('Super Mario Odyssey')">ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒªã‚ª ã‚ªãƒ‡ãƒƒã‚»ã‚¤</span>
                <span class="sample-game" onclick="setGameTitle('Minecraft')">Minecraft</span>
                <span class="sample-game" onclick="setGameTitle('Final Fantasy VII')">ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼VII</span>
                <span class="sample-game" onclick="setGameTitle('Pokemon Red and Blue')">ãƒã‚±ãƒƒãƒˆãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ èµ¤ãƒ»ç·‘</span>
            </div>
            
            <div class="input-group">
                <input type="text" id="game-title" placeholder="ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: The Legend of Zelda Breath of the Wildï¼‰" />
                <button onclick="testGameSearch()" id="search-btn">æ¤œç´¢</button>
            </div>
            
            <div id="search-results" class="results" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ APIæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
            <p>Wikipedia APIã®å„æ©Ÿèƒ½ã‚’å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <button onclick="testSearchFunction()">ãƒšãƒ¼ã‚¸æ¤œç´¢ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testContentFunction()">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å–å¾—ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testWikitextFunction()">Wikitextå–å¾—ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testInfoBoxFunction()">InfoBoxè§£æãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div id="api-results" class="results" style="display: none;"></div>
        </div>
    </div>

    <script src="js/wikipedia-service.js"></script>
    <script>
        const wikipediaService = new WikipediaService();

        function setGameTitle(title) {
            document.getElementById('game-title').value = title;
        }

        async function testGameSearch() {
            const gameTitle = document.getElementById('game-title').value.trim();
            const resultsDiv = document.getElementById('search-results');
            const searchBtn = document.getElementById('search-btn');
            
            if (!gameTitle) {
                alert('ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = '<p>ğŸ” Wikipediaã‹ã‚‰æƒ…å ±ã‚’å–å¾—ä¸­...</p>';
            searchBtn.disabled = true;
            
            try {
                const gameData = await wikipediaService.extractGameMetadata(gameTitle);
                
                if (gameData) {
                    resultsDiv.className = 'results success';
                    resultsDiv.innerHTML = `
                        <h3>âœ… å–å¾—æˆåŠŸ: ${gameData.title}</h3>
                        <div class="game-info">
                            <div class="info-item">
                                <div class="info-label">ã‚¿ã‚¤ãƒˆãƒ«</div>
                                <div class="info-value">${gameData.title || 'æƒ…å ±ãªã—'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">é–‹ç™ºè€…</div>
                                <div class="info-value">${gameData.developer || 'æƒ…å ±ãªã—'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ç™ºå£²å…ƒ</div>
                                <div class="info-value">${gameData.publisher || 'æƒ…å ±ãªã—'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ç™ºå£²æ—¥</div>
                                <div class="info-value">${gameData.releaseDate || 'æƒ…å ±ãªã—'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </div>
                                <div class="info-value">${Array.isArray(gameData.platforms) ? gameData.platforms.join(', ') : 'æƒ…å ±ãªã—'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ã‚¸ãƒ£ãƒ³ãƒ«</div>
                                <div class="info-value">${Array.isArray(gameData.genre) ? gameData.genre.join(', ') : 'æƒ…å ±ãªã—'}</div>
                            </div>
                        </div>
                        ${gameData.description ? `<div class="info-item" style="grid-column: 1 / -1; margin-top: 15px;"><div class="info-label">èª¬æ˜</div><div class="info-value">${gameData.description.substring(0, 300)}${gameData.description.length > 300 ? '...' : ''}</div></div>` : ''}
                        <div class="attribution">
                            <strong>ğŸ“„ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:</strong> <a href="${gameData.attribution.url}" target="_blank">${gameData.attribution.text}</a><br>
                            <strong>ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹:</strong> <a href="${gameData.attribution.licenseUrl}" target="_blank">${gameData.attribution.license}</a>
                        </div>
                    `;
                } else {
                    resultsDiv.className = 'results error';
                    resultsDiv.innerHTML = '<p>âŒ è©²å½“ã™ã‚‹ã‚²ãƒ¼ãƒ æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                }
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</p>`;
                console.error('Wikipedia search error:', error);
            } finally {
                searchBtn.disabled = false;
            }
        }

        async function testSearchFunction() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = '<p>ğŸ” ãƒšãƒ¼ã‚¸æ¤œç´¢æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
            
            try {
                const searchResults = await wikipediaService.searchGamePages('Minecraft');
                resultsDiv.className = 'results success';
                resultsDiv.innerHTML = `
                    <h3>âœ… æ¤œç´¢çµæœ (${searchResults.length}ä»¶)</h3>
                    <ul>
                        ${searchResults.slice(0, 5).map(result => 
                            `<li><strong>${result.title}</strong><br><small>${result.snippet}</small></li>`
                        ).join('')}
                    </ul>
                `;
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        async function testContentFunction() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = '<p>ğŸ“„ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å–å¾—æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
            
            try {
                const content = await wikipediaService.getPageContent('Minecraft');
                resultsDiv.className = 'results success';
                resultsDiv.innerHTML = `
                    <h3>âœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å–å¾—æˆåŠŸ</h3>
                    <p><strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${content.title}</p>
                    <p><strong>URL:</strong> <a href="${content.url}" target="_blank">${content.url}</a></p>
                    <p><strong>èª¬æ˜:</strong> ${content.extract ? content.extract.substring(0, 200) + '...' : 'æƒ…å ±ãªã—'}</p>
                `;
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        async function testWikitextFunction() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = '<p>ğŸ“ Wikitextå–å¾—æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
            
            try {
                const wikitext = await wikipediaService.getPageWikitext('Minecraft');
                resultsDiv.className = 'results success';
                resultsDiv.innerHTML = `
                    <h3>âœ… Wikitextå–å¾—æˆåŠŸ</h3>
                    <p><strong>æ–‡å­—æ•°:</strong> ${wikitext.length} æ–‡å­—</p>
                    <p><strong>å…ˆé ­éƒ¨åˆ†:</strong></p>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px;">${wikitext.substring(0, 500)}...</pre>
                `;
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        async function testInfoBoxFunction() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = '<p>ğŸ“Š InfoBoxè§£ææ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
            
            try {
                const wikitext = await wikipediaService.getPageWikitext('Minecraft');
                const infoboxData = await wikipediaService.parseInfoBox(wikitext);
                resultsDiv.className = 'results success';
                resultsDiv.innerHTML = `
                    <h3>âœ… InfoBoxè§£ææˆåŠŸ</h3>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px;">${JSON.stringify(infoboxData, null, 2)}</pre>
                `;
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // Enter key support
        document.getElementById('game-title').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testGameSearch();
            }
        });
    </script>
</body>
</html>